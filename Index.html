<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ù„Ø¹Ø¨Ø© Ù„ÙŠÙ† â€” Ø§Ù„ÙÙ†Ø§Ø¡ (Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©)</title>
<style>
:root{--accent:#6b4ad8}
html,body{height:100%;margin:0;font-family:Tahoma,Arial,sans-serif;background:linear-gradient(180deg,#eaf1ff,#fbf8ff)}
body{display:flex;align-items:center;justify-content:center;padding:16px}
#game{width:100%;max-width:900px;border-radius:12px;box-shadow:0 18px 40px rgba(60,34,100,0.12);background:linear-gradient(180deg,#ffffffcc,#fff);overflow:hidden;position:relative}
.header{display:flex;gap:16px;padding:12px;align-items:center;background:linear-gradient(180deg,#d7ecff,#cfe8ff)}
.avatar-box{width:150px;height:150px;border-radius:12px;overflow:hidden;flex-shrink:0;background:#fff;display:flex;align-items:center;justify-content:center}
.avatar-box img{width:100%;height:100%;object-fit:cover;display:block;transition:filter .35s,transform .35s}
.meta{flex:1}
h1{margin:0;font-size:20px;color:#2f2548}
.subtitle{margin:6px 0 0;color:#5d4e7a;font-size:13px}
.center{padding:18px}
#story{min-height:88px;padding:12px;background:linear-gradient(180deg,#fff,#fff0);border-radius:10px;color:#32284b;font-size:16px}
#choices{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
button.choice{padding:12px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-size:15px;cursor:pointer;transition:transform .12s,background .12s}
button.choice:active{transform:translateY(2px)}
.controls{display:flex;gap:8px;justify-content:center;padding:12px;flex-wrap:wrap}
.small{background:#f3eefc;border:0;padding:8px 12px;border-radius:10px;cursor:pointer;color:#35285a}
.status{display:flex;gap:10px;margin-top:10px;align-items:center}
.stat{flex:1;background:#f0ebff;padding:8px;border-radius:10px}
.stat .label{font-size:12px;color:#4a3b66;margin-bottom:6px}
.stat .bar{height:12px;background:#eee;border-radius:8px;overflow:hidden}
.stat .bar > div{height:100%;width:0%;background:linear-gradient(90deg,#ff8a8a,#ffb3b3);transition:width .35s}
.stat .bar.conf > div{background:linear-gradient(90deg,#6b4ad8,#a97de0)}
#end{padding:14px;text-align:center;color:#2f2548;white-space:pre-line}
footer{font-size:12px;color:#6d5f81;text-align:center;padding:12px 18px}
#particles{position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;overflow:hidden}
.particle{position:absolute;width:18px;height:18px;opacity:0;transform:translate(-50%,-50%)}
.star{background:radial-gradient(circle,#fff,#ffd700 40%,transparent 60%);border-radius:50%;box-shadow:0 0 6px rgba(255,215,0,0.8)}
.flower{background:radial-gradient(circle,#fff,#ff9fcf 40%,transparent 60%);border-radius:50%;box-shadow:0 0 6px rgba(255,160,180,0.9)}
#moodOverlay{position:absolute;left:0;top:0;right:0;bottom:0;background:rgba(0,0,0,0);transition:background .5s;pointer-events:none}
@media(max-width:600px){#choices{grid-template-columns:1fr} .header{flex-direction:column;align-items:center} .avatar-box{width:120px;height:120px}}
</style>
</head>
<body>
<div id="game" role="application" aria-live="polite">
  <div id="particles"></div>
  <div id="moodOverlay"></div>

  <div class="header">
    <div class="avatar-box" id="avatarBox">
      <!-- Ø¶Ø¹Ù‘ÙŠ Ù‡Ù†Ø§ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø«Ù„Ø§Ø« ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø¨Ø§Ø³Ù… normal.jpg, sad.jpg, happy.jpg -->
      <img id="avatarImg" src="normal.jpg" alt="Ù„ÙŠÙ† - Ø¹Ø§Ø¯ÙŠØ©">
    </div>
    <div class="meta">
      <h1>Ù„ÙŠÙ† â€” ÙÙŠ ÙÙ†Ø§Ø¡ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</h1>
      <div class="subtitle">Ù‚ØµØ© ØªÙØ§Ø¹Ù„ÙŠØ© Ù‚ØµÙŠØ±Ø© â€” Ø§Ø®ØªÙŠØ§Ø±Ø§ØªÙƒ ØªÙˆØ¶Ù‘Ø­ Ø§Ù„Ù…Ø³Ø§Ø±</div>
      <div class="status" aria-hidden="false">
        <div class="stat">
          <div class="label">Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©</div>
          <div class="bar conf"><div id="happyBar" style="width:50%"></div></div>
        </div>
        <div class="stat">
          <div class="label">Ø§Ù„Ø­Ø²Ù†</div>
          <div class="bar"><div id="sadBar" style="width:30%"></div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="center">
    <!-- Ø§Ù„Ù†Øµ Ø§Ù„Ø£ÙˆÙ„ Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ø¨Ø§Ù„Ø¶Ø¨Ø· Ø§Ù„Ù„ÙŠ Ø·Ù„Ø¨ØªÙŠÙ‡ -->
    <div id="story">ÙÙŠ ÙÙ†Ø§Ø¡ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©ØŒ Ø³Ù…Ø¹Øª Ù„ÙŠÙ† Ø¶Ø­ÙƒØ§Øª ÙˆÙ…Ù‡Ù…Ù‡Ù…Ø§Øª. Ø­Ø³Ù‘Øª Ø¥Ù†Ù‡Ù… ÙŠØ³Ø®Ø±ÙˆÙ† Ù…Ù† Ø²ÙŠÙ‘Ù‡Ø§. ÙƒÙŠÙ ØªØ±Ø¯Ù‘ÙŠÙ†ØŸ</div>
    <div id="choices" aria-label="Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©"></div>
    <div id="end"></div>
  </div>

  <div class="controls">
    <button id="sfxToggle" class="small">ğŸ”ˆ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª</button>
    <button id="tips" class="small">ğŸ’¡ Ù†ØµØ§ÙŠØ­</button>
    <button id="restart" class="small" style="display:none">ğŸ” Ø¥Ø¹Ø§Ø¯Ø©</button>
  </div>

  <footer>Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ¹Ù„ÙŠÙ…ÙŠØ© â€” Ø¥Ø°Ø§ ÙˆØ§Ø¬Ù‡ØªÙ ØªÙ†Ù…Ø± Ø­Ù‚ÙŠÙ‚ÙŠØŒ ÙƒÙ„Ù‘Ù…ÙŠ Ø´Ø®Øµ ØªØ«Ù‚ÙŠÙ† ÙÙŠÙ‡.</footer>
</div>

<script>
// Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ØµÙˆØ±: normal.jpg   sad.jpg   happy.jpg
const IMG_NORMAL = "normal.jpg";
const IMG_SAD = "sad.jpg";
const IMG_HAPPY = "happy.jpg";

/* Ø£ØµÙˆØ§Øª ÙˆÙ…ÙˆØ³ÙŠÙ‚Ù‰ Ø®Ù„ÙÙŠØ© (WebAudio) */
let audioCtx = null;
let sfxOn = true;
function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }

/* Ø®Ù„ÙÙŠØ© Ù†Ø§Ø¹Ù…Ø© Ø¬Ø¯Ø§Ù‹ */
let bg = null;
function startBackground(){
  try{
    ensureAudio();
    if(bg) return;
    const o1 = audioCtx.createOscillator(), o2 = audioCtx.createOscillator(), g = audioCtx.createGain();
    o1.type='sine'; o1.frequency.value = 110;
    o2.type='sine'; o2.frequency.value = 220;
    g.gain.value = 0.002; // very low
    o1.connect(g); o2.connect(g); g.connect(audioCtx.destination);
    o1.start(); o2.start();
    bg = {{o1:o1,o2:o2,g:g}};
  }catch(e){}
}
function stopBackground(){
  try{ if(bg){ bg.o1.stop(); bg.o2.stop(); bg = null; } }catch(e){}
}

/* Ù…Ø¤Ø«Ø±Ø§Øª Ù‚ØµÙŠØ±Ø© */
function sfxClick(){ if(!sfxOn) return; ensureAudio(); const o = audioCtx.createOscillator(), g = audioCtx.createGain(); o.type='sine'; o.frequency.value=880; g.gain.value=0.04; o.connect(g); g.connect(audioCtx.destination); const now = audioCtx.currentTime; o.start(now); g.gain.exponentialRampToValueAtTime(0.0001, now+0.18); o.stop(now+0.18); }
function sfxSuccess(){ if(!sfxOn) return; ensureAudio(); const o1 = audioCtx.createOscillator(), o2 = audioCtx.createOscillator(), g = audioCtx.createGain(); o1.type='triangle'; o1.frequency.value=880; o2.type='sine'; o2.frequency.value=1320; g.gain.value=0.045; o1.connect(g); o2.connect(g); g.connect(audioCtx.destination); const now = audioCtx.currentTime; o1.start(now); o2.start(now+0.03); g.gain.exponentialRampToValueAtTime(0.0001, now+0.6); o1.stop(now+0.6); o2.stop(now+0.63); }
function sfxSad(){ if(!sfxOn) return; ensureAudio(); const o = audioCtx.createOscillator(), g = audioCtx.createGain(); o.type='sawtooth'; o.frequency.value=220; g.gain.value=0.06; o.connect(g); g.connect(audioCtx.destination); const now = audioCtx.currentTime; o.start(now); g.gain.exponentialRampToValueAtTime(0.0001, now+0.45); o.stop(now+0.45); }
function sfxWhisper(){ if(!sfxOn) return; ensureAudio(); const bufferSize = audioCtx.sampleRate * 0.6; const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate); const data = buffer.getChannelData(0); for(let i=0;i<bufferSize;i++) data[i] = (Math.random()*2-1)*0.06; const src = audioCtx.createBufferSource(); src.buffer = buffer; const filt = audioCtx.createBiquadFilter(); filt.type='lowpass'; filt.frequency.value = 1200; const g = audioCtx.createGain(); g.gain.value = 0.06; src.connect(filt); filt.connect(g); g.connect(audioCtx.destination); src.start(); src.stop(audioCtx.currentTime + 0.6); }

/* Ø±Ø§ÙˆÙŠØ© Ø¨Ø³ÙŠØ·Ø© â€” ØµÙˆØª Ø¨Ù†Øª Ù†Ø§Ø¹Ù… Ø¹Ø¨Ø± SpeechSynthesis */
function narrate(text){
  if(!sfxOn) return;
  if('speechSynthesis' in window){
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'ar-SA'; u.rate = 1; u.pitch = 1.05; u.volume = 1.0;
    const voices = window.speechSynthesis.getVoices();
    if(voices && voices.length){
      // Ø§Ø®ØªØ§Ø± Ø£ÙˆÙ„ ØµÙˆØª Ø¹Ø±Ø¨ÙŠ Ù…ØªÙˆÙØ± Ø£Ùˆ Ø£ÙŠ ØµÙˆØª Ù…ØªØ§Ø­
      let found = voices.find(v=>v.lang && v.lang.startsWith('ar')) || voices[0];
      if(found) u.voice = found;
    }
    try{ if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); }catch(e){}
    window.speechSynthesis.cancel(); window.speechSynthesis.speak(u);
  }
}

/* particles (ÙˆØ±ÙˆØ¯ + Ù†Ø¬ÙˆÙ…) */
const particlesEl = document.getElementById('particles');
function spawnParticle(kind){
  const el = document.createElement('div');
  el.className = 'particle ' + (kind==='flower'?'flower':'star');
  const x = Math.random()*100;
  const y = Math.random()*40 + 20;
  el.style.left = x + '%';
  el.style.top = y + '%';
  particlesEl.appendChild(el);
  el.style.opacity = 1;
  el.style.transform = 'translate(-50%,-50%) scale(0.6)';
  setTimeout(()=>{ el.style.transition = 'all 1200ms ease-out'; el.style.transform = 'translate(-50%,-200%) scale(1)'; el.style.opacity = 0; },10);
  setTimeout(()=>{ try{ particlesEl.removeChild(el); }catch(e){} },1400);
}
function burstHappy(){ for(let i=0;i<10;i++) setTimeout(()=>spawnParticle(Math.random()>0.5?'flower':'star'), i*80); }
function moodSadOverlay(){ const mo = document.getElementById('moodOverlay'); mo.style.background = 'rgba(0,0,0,0.28)'; setTimeout(()=>{ mo.style.background = 'rgba(0,0,0,0)'; },900); }

/* Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ù€ UI */
let happy = 50, sad = 30;
const avatarImg = document.getElementById('avatarImg');
const happyBar = document.getElementById('happyBar');
const sadBar = document.getElementById('sadBar');
const storyEl = document.getElementById('story');
const choicesEl = document.getElementById('choices');
const endEl = document.getElementById('end');
const sfxToggle = document.getElementById('sfxToggle');
const restartBtn = document.getElementById('restart');
const tipsBtn = document.getElementById('tips');

function updateBarsAndAvatar(){
  happyBar.style.width = happy + '%';
  sadBar.style.width = sad + '%';
  if(happy - sad > 15){ avatarImg.src = IMG_HAPPY; avatarImg.style.filter = 'none'; }
  else if(sad - happy > 10){ avatarImg.src = IMG_SAD; avatarImg.style.filter = 'grayscale(60%)'; }
  else { avatarImg.src = IMG_NORMAL; avatarImg.style.filter = 'brightness(0.98)'; }
}

/* Ø§Ù„Ù†Øµ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ø­Ø±ÙÙŠ Ø²ÙŠ Ù…Ø§ Ø·Ù„Ø¨ØªÙŠ */
const START_TEXT = "ÙÙŠ ÙÙ†Ø§Ø¡ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©ØŒ Ø³Ù…Ø¹Øª Ù„ÙŠÙ† Ø¶Ø­ÙƒØ§Øª ÙˆÙ…Ù‡Ù…Ù‡Ù…Ø§Øª. Ø­Ø³Ù‘Øª Ø¥Ù†Ù‡Ù… ÙŠØ³Ø®Ø±ÙˆÙ† Ù…Ù† Ø²ÙŠÙ‘Ù‡Ø§. ÙƒÙŠÙ ØªØ±Ø¯Ù‘ÙŠÙ†ØŸ";

function setChoices(list){
  choicesEl.innerHTML = ''; endEl.textContent = ''; restartBtn.style.display = 'none';
  list.forEach(it=>{
    const b = document.createElement('button');
    b.className = 'choice'; b.textContent = it.text;
    b.onclick = ()=>{ sfxClick(); it.run(); };
    choicesEl.appendChild(b);
  });
  updateBarsAndAvatar();
}

/* Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø´Ù‡Ø¯ â€” Ø§Ù„Ø±Ø§ÙˆÙŠØ© ØªÙ‚Ø±Ø£ Ø§Ù„Ù†Øµ Ø§Ù„Ø£ÙˆÙ„ (Ø¨Ø§Ù„Ø¶Ø¨Ø·) */
function startScene(){
  storyEl.textContent = START_TEXT;
  // Ù‚ÙˆÙ„ Ø§Ù„Ù†Øµ Ø¨ØµÙˆØª Ø§Ù„Ø±Ø§ÙˆÙŠØ© (Ø¹Ø´Ø§Ù† ÙŠØ³Ù…Ø¹ÙˆÙ† Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù‚ØµØ©)
  narrate(START_TEXT);
  // Ø´ØºÙ‘Ù„ Ø§Ù„Ù…ÙŠÙˆØ²Ùƒ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù†Ø§Ø¹Ù…Ø©
  try{ startBackground(); }catch(e){}
  setChoices([
    {text:'Ø£ØªØ¬Ø§Ù‡Ù„Ù‡Ù… ÙˆØ£Ù…Ø´ÙŠ Ø¨Ø¹ÙŠØ¯', run: ignorePath},
    {text:'Ø£ÙˆØ§Ø¬Ù‡Ù‡Ù… Ø¨Ù‡Ø¯ÙˆØ¡ ÙˆØ£Ù‚ÙˆÙ„ ÙŠÙˆÙ‚ÙÙˆÙ†', run: confront},
    {text:'Ø£Ø¨Ù„Øº Ø§Ù„Ù…Ø¹Ù„Ù…Ø© ÙÙˆØ±Ø§Ù‹', run: tellTeacher},
    {text:'Ø£Ø±Ø¯ Ø¨Ù†ÙØ³ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨', run: retaliate}
  ]);
}

/* Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª â€” Ø¨Ø¹Ø¯ ÙƒÙ„ Ø§Ø®ØªÙŠØ§Ø±ØŒ Ø§Ù„Ø±Ø§ÙˆÙŠØ© ØªØ´Ø±Ø­ ÙˆØ´ ØµØ§Ø± Ø¨Ø§Ù„Ø¶Ø¨Ø· */
function ignorePath(){
  sad = Math.min(100, sad + 10); happy = Math.max(0, happy - 6); updateBarsAndAvatar();
  sfxWhisper(); moodSadOverlay(); sfxSad();
  const after = "Ø¶Ø­ÙƒÙˆØ§ Ø£ÙƒØ«Ø± Ù„Ù…Ø§ Ø³ÙƒØªØª Ù„ÙŠÙ†ØŒ ÙˆÙƒØ£Ù† ØµÙ…ØªÙ‡Ø§ Ø´Ø¬Ù‘Ø¹Ù‡Ù….";
  narrate(after);
  storyEl.textContent = after;
  setChoices([
    {text:'Ø£ÙØªØ­ Ù„ØµØ¯ÙŠÙ‚ØªÙŠ ÙˆØ£Ø­ÙƒÙŠ', run: ()=>{
       happy = Math.min(100, happy + 15); sad = Math.max(0, sad - 10); updateBarsAndAvatar();
       burstHappy(); sfxSuccess();
       const a = "Ø§Ù†Ø¶Ù…Øª Ù„Ù‡Ø§ ØµØ¯ÙŠÙ‚ØªÙ‡Ø§ ÙˆÙˆÙ‚ÙØª Ù…Ø¹Ù‡Ø§ØŒ ÙˆØ¨Ø¯Ø£Øª Ø§Ù„Ø³Ù„Ø·Ø§Øª Ø¨Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø±.";
       narrate(a); storyEl.textContent = a;
       setTimeout(()=>finalSummary(),700);
    }},
    {text:'Ø£ÙƒØªÙ… ÙˆØ£Ù…Ø´ÙŠ', run: ()=>{
       sad = Math.min(100, sad + 12); happy = Math.max(0, happy - 8); updateBarsAndAvatar();
       sfxSad(); moodSadOverlay();
       const a = "Ø±ÙƒØ¶Øª Ù„ÙŠÙ† ÙˆÙ‡ÙŠ ØªØ­Ø§ÙˆÙ„ ØªØ®ÙÙŠ Ø¯Ù…Ø¹ØªÙ‡Ø§ØŒ Ù„ÙƒÙ† Ù‚Ù„Ø¨Ù‡Ø§ ØªØ£Ù„Ù….";
       narrate(a); storyEl.textContent = a;
       setTimeout(()=>finalSummary(),700);
    }}
  ]);
}

function confront(){
  happy = Math.min(100, happy + 8); sad = Math.max(0, sad - 6); updateBarsAndAvatar();
  sfxWhisper(); sfxClick();
  const after = "ØªÙØ§Ø¬Ø£ÙˆØ§ Ù…Ù† ÙƒÙ„Ø§Ù…Ù‡Ø§ØŒ ÙˆØ³ÙƒØªÙˆØ§ Ù„Ø­Ø¸Ø©â€¦ Ø¨Ø¹Ø¶Ù‡Ù… Ù„Ù… ÙŠØªÙˆÙ‚Ø¹ Ø£Ù† ØªØ³Ù…Ø¹Ù‡Ù… Ø±Ø¯Ù‘Ù‡Ø§.";
  narrate(after); storyEl.textContent = after;
  setChoices([
    {text:'Ø£Ø·Ù„Ø¨ Ø§Ø¹ØªØ°Ø§Ø± ÙˆØ­Ø¯ÙˆØ¯', run: ()=>{
      happy = Math.min(100, happy + 12); sad = Math.max(0, sad - 8); updateBarsAndAvatar();
      burstHappy(); sfxSuccess();
      const a = "Ø§Ø¹ØªØ±ÙÙˆØ§ Ø¨Ø®Ø·Ø¦Ù‡Ù… ÙˆØ§Ø¹ØªØ°Ø±ÙˆØ§ØŒ ÙˆØµØ§Ø±Øª Ù…Ø³Ø§ÙØ© Ø§Ù„Ø§Ø­ØªØ±Ø§Ù… Ø£ÙˆØ¶Ø­.";
      narrate(a); storyEl.textContent = a;
      setTimeout(()=>finalSummary(),700);
    }},
    {text:'Ø£Ù…Ø´ÙŠ Ø¨Ø«Ù‚Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø¨ÙŠØ±', run: ()=>{
      happy = Math.min(100, happy + 8); sad = Math.max(0, sad - 5); updateBarsAndAvatar();
      burstHappy(); sfxClick();
      const a = "ØºØ§Ø¯Ø±Øª Ù„ÙŠÙ† Ø¨Ø«Ù‚Ø©ØŒ ÙˆÙƒØ£Ù† ÙƒÙ„Ø§Ù…Ù‡Ø§ Ø±Ø³Ø® ÙÙŠ Ø£Ø°Ù‡Ø§Ù† Ø§Ù„Ø¨Ø¹Ø¶.";
      narrate(a); storyEl.textContent = a;
      setTimeout(()=>finalSummary(),700);
    }}
  ]);
}

function tellTeacher(){
  sfxWhisper();
  const after = "Ø§Ù„Ù…Ø¹Ù„Ù…Ø© ØªØ¯Ø®Ù„Øª Ø¨Ø­Ø²Ù… ÙˆØ·Ù„Ø¨Øª Ø´Ø±Ø­ Ø§Ù„Ù…ÙˆÙ‚ÙØ› Ø¨Ø¹Ø¶Ù‡Ù† Ø§Ø¹ØªØ°Ø±Ù† Ø¬Ø²Ø¦ÙŠØ§Ù‹.";
  narrate(after); storyEl.textContent = after;
  setChoices([
    {text:'Ø£Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø± ÙˆØ£Ù…Ø´ÙŠ', run: ()=>{
      happy = Math.min(100, happy + 10); sad = Math.max(0, sad - 10); updateBarsAndAvatar();
      burstHappy(); sfxSuccess();
      const a = "Ù‚Ø¨Ù„Øª Ù„ÙŠÙ† Ø§Ù„Ø§Ø¹ØªØ°Ø§Ø± ÙˆØ±Ø¬Ø¹Øª ØªÙ…Ø´ÙŠ Ø¨Ø«Ù‚Ø© Ù…Ø¹ ÙˆØ¹ÙŠ Ø£ÙƒØ¨Ø±.";
      narrate(a); storyEl.textContent = a;
      setTimeout(()=>finalSummary(),700);
    }},
    {text:'Ø£Ø·Ù„Ø¨ Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ù† Ø§Ù„Ù…Ø±Ø´Ø¯Ø©', run: ()=>{
      happy = Math.min(100, happy + 14); sad = Math.max(0, sad - 12); updateBarsAndAvatar();
      burstHappy(); sfxSuccess();
      const a = "ØªØ§Ø¨Ø¹Øª Ù…Ø¹ Ø§Ù„Ù…Ø±Ø´Ø¯Ø©ØŒ ÙˆØµØ§Ø±Øª Ø®Ø·ÙˆØ§Øª ØªÙˆØ¹ÙŠØ© Ø¨Ø§Ù„Ù…Ø¯Ø±Ø³Ø©.";
      narrate(a); storyEl.textContent = a;
      setTimeout(()=>finalSummary(),700);
    }}
  ]);
}

function retaliate(){
  sfxWhisper(); sfxSad();
  const after = "Ù„ÙŠÙ† Ø±Ø¯Øª Ø¨Ù†ÙØ³ Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ØŒ ÙˆØ§Ù„Ù…ÙˆÙ‚Ù ØªØµØ§Ø¹Ø¯Ø› Ø¨Ø¹Ø¶ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù†Ù‚Ø³Ù…ÙˆØ§ Ø¨ÙŠÙ† Ù…Ø¤ÙŠØ¯ ÙˆÙ…Ø¹Ø§Ø±Ø¶.";
  narrate(after); storyEl.textContent = after;
  setChoices([
    {text:'Ø£Ø¹ØªØ°Ø± ÙˆØ£Ø­Ø§ÙˆÙ„ Ø£ØµÙ„Ø­', run: ()=>{
      sad = Math.min(100, sad + 8); happy = Math.max(0, happy - 6); updateBarsAndAvatar();
      sfxSad(); moodSadOverlay();
      const a = "Ù„Ø­Ù‚Ù‡Ø§ Ù†Ø¯Ù…ØŒ ÙˆØ¨Ø¯Ø£Øª ØªØµÙ„Ø­ Ø§Ù„Ù…ÙˆÙ‚Ù Ø¨Ø§Ù„ØªÙˆØ§Ø¶Ø¹.";
      narrate(a); storyEl.textContent = a;
      setTimeout(()=>finalSummary(),700);
    }},
    {text:'Ø£Ø«Ø¨Øª Ù…ÙˆÙ‚ÙÙŠ Ù„Ø£Ù† Ù„Ø§Ø²Ù… ÙŠØªØ¹Ù„Ù…ÙˆÙ†', run: ()=>{
      happy = Math.min(100, happy + 6); sad = Math.min(100, sad + 6); updateBarsAndAvatar();
      sfxClick();
      const a = "Ø¨Ø¹Ø¶Ù‡Ù… Ø§Ø­ØªØ±Ù… Ù…ÙˆÙ‚ÙÙ‡Ø§ØŒ ÙˆØ¨Ø¹Ø¶Ù‡Ù… Ø§Ù†ØªÙ‚Ø¯Ø› Ø§Ù„ØªØ¬Ø±Ø¨Ø© ØªØ±ÙƒØª Ø£Ø«Ø±Ù‹Ø§ Ù…Ø®ØªÙ„Ø·Ù‹Ø§.";
      narrate(a); storyEl.textContent = a;
      setTimeout(()=>finalSummary(),700);
    }}
  ]);
}

function finalSummary(){
  let title, msg, encourage;
  if(happy - sad > 15){ title = 'Ù†Ù‡Ø§ÙŠØ© Ù…Ø´Ø±Ù‚Ø©'; msg = 'Ù„ÙŠÙ† Ø®Ø±Ø¬Øª Ø£Ù‚ÙˆÙ‰ ÙˆÙˆØ§Ø«Ù‚Ø©.'; encourage = 'Ø£Ø­Ø³Ù†ØªÙ Ù„ÙŠÙ†ØŒ Ø§Ø³ØªÙ…Ø±ÙŠ Ø¨Ø«Ù‚ØªÙƒ!'; sfxSuccess(); avatarImg.src = IMG_HAPPY; burstHappy(); }
  else if(sad - happy > 10){ title = 'Ù†Ù‡Ø§ÙŠØ© Ø­Ø²ÙŠÙ†Ø©'; msg = 'Ù„ÙŠÙ† Ø´Ø¹Ø±Øª Ø¨Ø§Ù„Ø£Ù„Ù… Ù„ÙƒÙ†Ù‡Ø§ Ø¨Ø¯Ø£Øª ØªØ·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©.'; encourage = 'Ù„ÙŠØ³ Ø¹ÙŠØ¨Ø§ Ø£Ù† ØªØ·Ù„Ø¨ÙŠ Ø§Ù„Ø¯Ø¹Ù…ØŒ Ù‡Ø°Ø§ Ø¯Ù„ÙŠÙ„ Ù‚ÙˆØ©.'; sfxSad(); moodSadOverlay(); avatarImg.src = IMG_SAD; }
  else { title = 'Ù†Ù‡Ø§ÙŠØ© Ù…ØªÙˆØ§Ø²Ù†Ø©'; msg = 'Ù„ÙŠÙ† ØªØ¹Ù„Ù…Øª Ø´ÙŠØ¦Ù‹Ø§ ÙˆØ®Ø·Øª Ø®Ø·ÙˆØ© Ù„Ù„Ø£Ù…Ø§Ù….'; encourage = 'ÙƒÙ„ ØªØ¬Ø±Ø¨Ø© ØªØ¹Ù„Ù…ÙƒØŒ ØªØ§Ø¨Ø¹ÙŠ ÙˆØªÙ‚Ø¯Ù…ÙŠ.'; sfxClick(); avatarImg.src = IMG_NORMAL; }
  endEl.textContent = title + "\\n\\n" + msg + "\\n\\n" + 'Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø³Ø¹Ø§Ø¯Ø©: ' + happy + '%\\nÙ…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø²Ù†: ' + sad + '%';
  narrate(encourage);
  restartBtn.style.display = 'inline-block';
  restartBtn.onclick = ()=> location.reload();
  choicesEl.innerHTML = '';
  try{ if(bg && bg.g){ bg.g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+0.6); } }catch(e){}
}

/* ØªØ­ÙƒÙ…Ø§Øª */
sfxToggle.addEventListener('click', ()=>{ sfxOn = !sfxOn; sfxToggle.textContent = sfxOn ? 'ğŸ”ˆ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª' : 'ğŸ”‡ ÙƒØªÙ… Ø§Ù„Ø£ØµÙˆØ§Øª'; if(sfxOn) ensureAudio(); });
tipsBtn.addEventListener('click', ()=> alert('Ù†ØµØ§ÙŠØ­:\\nâ€¢ ØªÙƒÙ„Ù…ÙŠ Ù…Ø¹ Ø´Ø®Øµ ØªØ«Ù‚ÙŠÙ† ÙÙŠÙ‡.\\nâ€¢ Ø³Ø¬Ù‘Ù„ÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ù Ù„Ùˆ ØªÙƒØ±Ø±Øª.\\nâ€¢ Ø§Ù„ØªØ¹Ø¨ÙŠØ± Ø§Ù„Ù‡Ø§Ø¯Ø¦ Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø£Ù‚ÙˆÙ‰ Ù…Ù† Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù….'));

document.addEventListener('click', function unlock(){ try{ ensureAudio(); if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); startBackground(); }catch(e){} document.removeEventListener('click', unlock); }, {once:true});

/* Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø´Ù‡Ø¯ */
startScene();
</script>
</body>
</html>
